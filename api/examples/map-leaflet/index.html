<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ant Web | Examples | Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
    <!--[if lte IE 8]>
      <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
    <![endif]-->

    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/vendor/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="css/vendor/MarkerCluster.css" />

    <style type="text/css">
      #map { 
        max-width: 1048px;
        height: 400px; 
      }
    </style>
  </head>
  <body>

    <div id="map"></div>

    <script src="js/vendor/jquery-1.10.2.min.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
    <script src="js/vendor/leaflet.markercluster-src.js"></script>

    <script type="text/javascript">

      $(function() {

        var cloudmadeUrl = 'http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png';
        var cloudmadeAttribution = 'antweb';
        var cloudmade = L.tileLayer(cloudmadeUrl, { maxZoom: 18, attribution: cloudmadeAttribution });
        var latlng = L.latLng(0, 0);

        var map = L.map('map'
          , {
            center: latlng
            , zoom: 2
            , layers: [ cloudmade ]
          }
        );

        var data;
        var lon;
        var lat
        var point;
        var markers = new L.MarkerClusterGroup();

        $.getJSON('data/sample.json', function(response) {

          $.each(response, function(key, val) {
            // console.log(val);

            data = val.meta;
            lat = data.decimal_latitude;
            lng = data.decimal_longitude;

            name = "";
            name += "<b>" + data.code + "</b><br>";
            name += "<p>";
            name += "<b>Subfamily:</b> " + data.subfamily + "<br>";
            name += "<b>Genus:</b> " + data.genus + "<br>";
            name += "<b>Species:</b> " + data.species + "<br>";
            name += "</p>";

            if (lat !== null && lng !== null) {

              marker = L.marker([lat, lng], { title : name });
              marker.bindPopup(name);
              markers.addLayer(marker);

            }
            // if (lat !== null && lng !== null) {

            //   point = L.circle([lat, lng], 100, {
            //     color: 'red',
            //     fillColor: '#f03',
            //     fillOpacity: 0.5
            //   })
            //   .addTo(map)
            //   .bindPopup(name)
            //   ;

            // }

          });

          map.addLayer(markers);

        });

      }); // Ready
    </script>
  </body>
</html>
